<div class="canales-container">
  <app-sidebar></app-sidebar>
  <!-- Loading Indicator -->
  <div class="content-area">
  <div *ngIf="loading" class="text-center p-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2">Cargando información de la operación...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error && !loading" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
  </div>

  <!-- Operación Content -->
  <div *ngIf="operacion && !loading && !error" class="operacion-detail">
    <!-- Primer bloque de información -->
    <div class="operacion-header-card">
      <div class="header-main-section">
        <div class="operacion-info">
          <div class="title-badge-wrapper">
            <button class="btn btn-icon btn-light me-3" (click)="goBack()">
              <i class="bi bi-arrow-left"></i>
            </button>
            <h2 class="operacion-title">Operación #{{ operacion.id }}</h2>
            <div class="badge" [ngClass]="getEstadoClass(operacion.estado || '')">
              {{ operacion.estado || 'Ingresada' }}
            </div>
          </div>
          <div class="plan-info">
            <span>{{ cliente?.nombre }} {{ cliente?.apellido }}</span>
            <span class="separator">|</span>
            <span>{{ cliente?.telefono }}</span>
            <span class="separator">|</span>
            <span>{{ cliente?.email }}</span>
          </div>
        </div>
      </div>
      <div class="additional-info">
        <div class="info-item">
          <i class="bi bi-calendar3"></i>
          <span>Fecha: {{ formatDate(operacion.fechaCreacion) }}</span>
        </div>
        <div class="info-item">
          <i class="bi bi-shop"></i>
          <span>Canal: <a class="text-dark fw-bold text-hover-primary cursor-pointer" (click)="verDetalleCanal(operacion.canalId)">{{ operacion.canalNombre }}</a></span>
        </div>
        <div class="info-item">
          <i class="bi bi-diagram-3"></i>
          <span>Subcanal: <a class="text-dark fw-bold text-hover-primary cursor-pointer" (click)="verDetalleSubcanal(operacion.subcanalId)">{{ operacion.subcanalNombre }}</a></span>
        </div>
        <div class="info-item">
          <i class="bi bi-person"></i>
          <span>Vendor: <a class="text-dark fw-bold text-hover-primary cursor-pointer" (click)="verDetalleUsuario(operacion.vendedorId || 0)">{{ operacion.vendedorNombre }}</a></span>
        </div>
      </div>
    </div>

    <!-- Contenido principal en cards separadas -->
   <!-- Modificar la estructura del grid y cards -->
<div class="components-grid">

<!-- Detalles de la operación inicial -->
<div class="card equal-height">
  <div class="card-header">
    <div class="card-title">
      <i class="bi bi-clipboard-data me-2 text-primary"></i>
      Operación Inicial
    </div>
  </div>
  <div class="card-body">
    <div class="details-grid">
      <div class="detail-section">
        <div class="detail-row">
          <div class="detail-label">Monto:</div>
          <div class="detail-value fw-bold">{{ formatMonto(operacion.monto) }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Plazo:</div>
          <div class="detail-value">{{ operacion.meses }} meses</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Plan:</div>
          <div class="detail-value">{{ operacion.planNombre || 'No especificado' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Tasa:</div>
          <div class="detail-value">{{ operacion.tasa }}%</div>
        </div>
        <!-- Nuevos campos -->
        <div class="detail-row">
          <div class="detail-label">Cuota:</div>
          <div class="detail-value">{{ operacion.cuotaInicial ? formatMonto(operacion.cuotaInicial) : '-' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Cuota promedio:</div>
          <div class="detail-value">{{ operacion.cuotaPromedio ? formatMonto(operacion.cuotaPromedio) : '-' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Auto:</div>
          <div class="detail-value">{{ operacion.autoInicial || 'No especificado' }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Detalles de la operación final -->
<div class="card equal-height">
  <div class="card-header">
    <div class="card-title">
      <i class="bi bi-clipboard-check me-2 text-success"></i>
      Operación Final
    </div>
  </div>
  <div class="card-body">
    <div class="details-grid">
      <div class="detail-section">
        <div class="detail-row">
          <div class="detail-label">Monto:</div>
          <div class="detail-value fw-bold">{{ operacion.montoAprobado ? formatMonto(operacion.montoAprobado) : 'Pendiente' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Plazo:</div>
          <div class="detail-value">{{ operacion.mesesAprobados ? operacion.mesesAprobados + ' meses' : 'Pendiente' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Plan aprobado:</div>
          <div class="detail-value">{{ operacion.planAprobadoNombre || 'Pendiente' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Tasa:</div>
          <div class="detail-value">{{ operacion.tasaAprobada ? operacion.tasaAprobada + '%' : 'Pendiente' }}</div>
        </div>

        <!-- Nuevos campos -->
        <div class="detail-row">
          <div class="detail-label">Cuota inicial:</div>
          <div class="detail-value">{{ operacion.cuotaInicialAprobada ? formatMonto(operacion.cuotaInicialAprobada) : 'Pendiente' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Cuota promedio:</div>
          <div class="detail-value">{{ operacion.cuotaPromedioAprobada ? formatMonto(operacion.cuotaPromedioAprobada) : 'Pendiente' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Auto:</div>
          <div class="detail-value">{{ operacion.autoAprobado || 'Pendiente' }}</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Ver aprobado definitivo:</div>
          <div class="detail-value">
            <a *ngIf="operacion.urlAprobadoDefinitivo" [href]="operacion.urlAprobadoDefinitivo" target="_blank">
              Ver documento
            </a>
            <span *ngIf="!operacion.urlAprobadoDefinitivo">Pendiente</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card equal-height" *ngIf="operacion.observaciones">
  <div class="card-header">
    <div class="card-title">
      <i class="bi bi-chat-text me-2 text-primary"></i>
      Observaciones
    </div>
  </div>
  <div class="card-body">
    <p class="mb-0">{{ operacion.observaciones }}</p>
  </div>
</div>
</div>
  </div>
  </div>
  </div>
