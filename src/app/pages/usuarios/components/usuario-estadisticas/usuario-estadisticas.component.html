<div class="estadisticas-container">
  <!-- Contenido de dos columnas -->
  <div class="stats-grid-2col">
    <!-- Gráfico de operaciones por mes -->
    <div class="chart-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-graph-up me-2 text-primary"></i>
          Operaciones por Mes
        </h3>
      </div>
      <div class="card-body">
        <div class="chart-container">
          <canvas #operacionesPorMesChart></canvas>
          <div *ngIf="!hasSufficientData" class="chart-no-data">
            <i class="bi bi-bar-chart"></i>
            <p>No hay suficientes datos para mostrar el gráfico</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Estadísticas de Rendimiento -->
    <div class="performance-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-clipboard-data me-2 text-primary"></i>
          Rendimiento
        </h3>
      </div>
      <div class="card-body">
        <!-- Promedio Mensual -->
        <div class="performance-item">
          <div class="performance-label">Promedio Mensual</div>
          <div class="performance-data">
            <div class="performance-value">{{ promedioMensual }} operaciones</div>
            <div class="performance-trend" [ngClass]="getPerformanceTrendClass(trendMensual)">
              <i class="bi" [ngClass]="getTrendIconClass(trendMensual)"></i>
              <span>{{ getTrendPercentage(trendMensual) }}</span>
            </div>
          </div>
        </div>

        <!-- Monto Promedio -->
        <div class="performance-item">
          <div class="performance-label">Monto Promedio</div>
          <div class="performance-data">
            <div class="performance-value">{{ formatMontoSinDecimales(montoPromedio) }}</div>
            <div class="performance-trend" [ngClass]="getPerformanceTrendClass(trendMonto)">
              <i class="bi" [ngClass]="getTrendIconClass(trendMonto)"></i>
              <span>{{ getTrendPercentage(trendMonto) }}</span>
            </div>
          </div>
        </div>

        <!-- Clientes Nuevos (Último Mes) -->
        <div class="performance-item">
          <div class="performance-label">Clientes Nuevos (Último Mes)</div>
          <div class="performance-data">
            <div class="performance-value">{{ clientesNuevosMes }}</div>
            <div class="performance-trend" [ngClass]="getPerformanceTrendClass(trendClientes)">
              <i class="bi" [ngClass]="getTrendIconClass(trendClientes)"></i>
              <span>{{ getTrendPercentage(trendClientes) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Segunda fila con gráficos específicos por rol -->
  <div class="stats-grid-2col mt-4">
    <!-- Gráfico específico según rol (Subcanales para AdminCanal, Canales para OficialComercial) -->
    <div class="chart-card" *ngIf="usuario.rolId === 2 || usuario.rolId === 4">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi" [ngClass]="usuario.rolId === 2 ? 'bi-diagram-3' : 'bi-grid-3x3-gap'" class="me-2 text-primary"></i>
          {{ usuario.rolId === 2 ? 'Operaciones por Subcanal' : 'Operaciones por Canal' }}
        </h3>
      </div>
      <div class="card-body">
        <div class="chart-container">
          <canvas #canalesOperacionesChart></canvas>
          <div *ngIf="(usuario.rolId === 2 && (!subcanales || subcanales.length === 0)) ||
                     (usuario.rolId === 4 && (!canales || canales.length === 0))"
               class="chart-no-data">
            <i class="bi" [ngClass]="usuario.rolId === 2 ? 'bi-diagram-3' : 'bi-grid-3x3-gap'"></i>
            <p>No hay datos para mostrar</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráfico de vendedores (para AdminCanal y OficialComercial) -->
    <div class="chart-card" *ngIf="usuario.rolId === 2 || usuario.rolId === 4">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-people me-2 text-primary"></i>
          Rendimiento de Vendedores
        </h3>
      </div>
      <div class="card-body">
        <div class="chart-container">
          <canvas #vendorsOperacionesChart></canvas>
          <div *ngIf="!vendors || vendors.length === 0" class="chart-no-data">
            <i class="bi bi-people"></i>
            <p>No hay vendedores asignados</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
